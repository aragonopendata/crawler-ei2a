"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var $tree,ENDPOINT="/web-server/rest/executeWorkFlowGet/",ACTION={getcategories:"58dcf0e123ea5e62b5072dba",getwordsfromcategory:"58de2bca23ea5e62b5072dc5",addwordtocategory:"58de55fc23ea5e62b5072de1",removewordfromcategory:"58de5d7723ea5e62b5072de5",addcategory:"58de343623ea5e62b5072dca",removecategory:"58de4a7c23ea5e62b5072dd1"},resultvar="ontologyHierarchy",conceptURI="",idioma="es",jstree_statekey="tree_categorias";$(function(){$(document).ajaxStart(function(){$(".loading").addClass("show")}).ajaxComplete(function(){$(".loading").removeClass("show")})});var tree=new Vue({el:document.getElementById("vue-arbol"),data:function(){return[{id:"ontology",text:"Ontología",parent:"#",a_attr:{"data-uri":"root"}}]},template:'<div><h4>Ontología</h4><div class="input-group"><input @input="search" type="text" class="search form-control" placeholder="Filtrar por..."><span class="input-group-addon"><span class="glyphicon glyphicon-search"></span></span></div><div id="jstree" @click="loadConcept"></div></div>',methods:{debounce:function(a,o){var r=this,c=void 0;return function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];clearTimeout(c),c=setTimeout(function(){return a.call.apply(a,[r].concat(e))},o)}},loadConcept:function(t){var e=t.target;"A"===e.nodeName&&(conceptURI=e.dataset.uri,app.loadConcept())},loadOntology:function(){$.getJSON(ENDPOINT+ACTION.getcategories+"?"+$.param({wait:!0})).then(this.updatejstree)},createjstree:function(t){$.jstree.defaults.state.key=jstree_statekey,$.jstree.defaults.search.show_only_matches=!0,$.jstree.defaults.search.show_only_matches_children=!0,$tree=$(document.getElementById("jstree")).jstree({plugins:["search","state","sort"],state:{key:jstree_statekey},core:{data:t,expand_selected_onload:!0,check_callback:!0,themes:{name:"proton"}}})},updatejstree:function(t){var e=this,n=(new DOMParser).parseFromString(t.results.ontologyHierarchy,"text/xml"),a=[].concat(_toConsumableArray(n.querySelectorAll("node"))).map(function(t){return{id:t.getAttribute("name"),text:e.fromCamelCase(e.spanish(t.getAttribute("name"))),parent:t.parentNode.getAttribute("name")||"ontology",a_attr:{"data-uri":t.getAttribute("uri")}}});a.unshift({id:"ontology",text:"Ontología",parent:"#",a_attr:{"data-uri":"root"}}),$tree&&"jstree"in $tree?($tree.jstree(!0).settings.core.data=a,$tree.jstree(!0).refresh()):this.createjstree(a)},spanish:function(t){return"GeneralOntology"===t?"Categorizados":"Unknown"===t?"Sin Categorizar":t},fromCamelCase:function(t){return t.replace(/([A-Z])/g," $1").trim()}},created:function(){this.search=this.debounce(function(t){var e=t.target;$("#jstree").jstree(!0).search(e.value)},250)},mounted:function(){this.loadOntology()}}),app=new Vue({el:document.getElementById("vue-conceptos"),data:function(){return{category:"",concepts:[{name:"",weight:""}],newword:"",newweight:"1.0",newcategory:""}},template:'<table v-show="category !== \'\'" class="table table-condensed table-hover"><tbody><tr><th>Categoria</th><th>Nueva Subcategoría</th><th width="20"></th></tr><tr class="info"><td><button @click="deleteCategory" :title="\'Eliminar categoria: \'+ category" class="btn btn-xs btn-danger"><i class="fa fa-trash"></i></button>&nbsp;<span class="category-title">{{category | spanish | fromCamelCase}}</span></td><td><input class="form-control input-sm" v-model="newcategory"></td><td><button @click="addCategory" :title="\'Añadir subcategoría a:\'+ category" class="btn btn-sm btn-success"><i class="fa fa-edit"></i> Añadir subcategoría</button></td></tr><tr><td colspan="10">&nbsp;</td></tr><tr><th>Concepto</th><th>Peso</th><th width="20"></th></tr><tr v-for="concept in concepts"><td><button :title="\'Eliminar concepto: \'+ concept.name" class="btn btn-xs btn-danger" @click="deleteConcept(concept.name)"><i class="fa fa-trash"></i></button>&nbsp;{{concept.name}}</td><td>{{concept.weight}}</td><td></td><tr><tr class="info"><td><input class="form-control" v-model="newword"></td><td><input class="form-control" v-model="newweight"></td><td><button @click="addConcept" title="Añadir este concepto nuevo" class="btn btn-success"><i class="fa fa-edit"></i> Añadir</button></td></tr></tbody></table>',methods:{delete:function(){this.update({category:"",concepts:[]})},update:function(t){var e=t.category,n=t.concepts;this.$data.category=e,this.$data.concepts=n},loadConcept:function(){var a=this;$.getJSON(ENDPOINT+ACTION.getwordsfromcategory+"?"+$.param({language:idioma,conceptURI:conceptURI,wait:!0})).then(function(t){var e=document.createElement("div");e.insertAdjacentHTML("beforeend",t.results.synonyms||"");var n=[].concat(_toConsumableArray(e.querySelectorAll("word")));a.update({category:t.parameters.conceptURI.split("#")[1],concepts:n.map(function(t){return{name:t.textContent,weight:t.getAttribute("weight")}})})})},addConcept:function(){var t={language:idioma,conceptURI:conceptURI,word:encodeURIComponent(this.$data.newword),weight:encodeURIComponent(this.$data.newweight),wait:!0};if(""===t.word)return alert("Debe introducir un concepto nuevo en el campo correspondiente");this.$data.newword="",this.$data.newweight="1.0",$.getJSON(ENDPOINT+ACTION.addwordtocategory+"?"+$.param(t),this.loadConcept)},deleteConcept:function(t){var e={language:idioma,conceptURI:conceptURI,word:encodeURIComponent(t),wait:!0};confirm("¿Está seguro que quiere borrar la palabra?:"+t)&&$.getJSON(ENDPOINT+ACTION.removewordfromcategory+"?"+$.param(e),this.loadConcept)},addCategory:function(){var t={concept:encodeURIComponent(this.$data.newcategory),conceptURI:conceptURI,wait:!0};if(""===t.concept)return alert("Debe introducir una subcategoría nueva en el campo correspondiente");this.$data.newcategory="",$.getJSON(ENDPOINT+ACTION.addcategory+"?"+$.param(t),tree.loadOntology)},deleteCategory:function(){var t={conceptURI:conceptURI,wait:!0};confirm("¿Está seguro que quiere borrar esta categoría?")&&$.getJSON(ENDPOINT+ACTION.removecategory+"?"+$.param(t),tree.loadOntology).then(this.delete)}},filters:{spanish:function(t){return"GeneralOntology"===t?"Categorizados":"Unknown"===t?"Sin Categorizar":t},fromCamelCase:function(t){return t.replace(/([A-Z])/g," $1").trim()}}});