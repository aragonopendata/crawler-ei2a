"use strict";var _slicedToArray=function(n,e){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return function(n,e){var t=[],a=!0,o=!1,r=void 0;try{for(var s,i=n[Symbol.iterator]();!(a=(s=i.next()).done)&&(t.push(s.value),!e||t.length!==e);a=!0);}catch(n){o=!0,r=n}finally{try{!a&&i.return&&i.return()}finally{if(o)throw r}}return t}(n,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},URLdomain=document.location.origin;console.warn(document.location.origin),$(".btn_popbar").on("click",function(n){n.target.nextElementSibling.classList.toggle("width0")});var isURL=function(n){return new RegExp("^https?://.+").test(n)&&!n.includes("ei2a/categorization")},printPanel=function(n,e,o){return'<div class="list-group">'+(n?'<div class="list-group-item active">'+n+"</div>":"")+Object.entries(e).map(function(n){var e=_slicedToArray(n,2),t=e[0],a=e[1];return Array.isArray(a)?"<div class='list-group-item'><strong>"+t+"</strong><div class='list-group'>"+a.map(function(n){return"<div class='list-group-item'>"+n+"</div>"}).join("")+"</div></div>":"<div class='list-group-item'>"+(o?"<strong>"+t+"</strong><br/>":"")+(isURL(a)?(55<a.length?a.slice(0,52)+"...":a).link(a):a)+"</div>"}).join("")+"</div>"},data={info:{},solrInfo:{},alertMaxNodes:!1,numNodes:20,question:"",urlQuestionWorkflow:URLdomain+"/web-server/rest/executeWorkFlowGet/5afbf8699194be00015eb2ee?save=false&wait=true&question=",content:{answer:!1,message:"",results:{}},warning:"",lang:"es",translate:{actualDate:{es:"Última actualización"}}},vue_numNodes=new Vue({el:document.getElementById("nodesSlider"),template:'<form class="form-horizontal"><div class="form-group form-group-sm"><label class="col-sm-4 control-label" for="numNodes">{{numNodes}} nodos máximo</label><div class="col-sm-8"><input id="numNodes" class="form-control input-sm" type="range" min="10" max="100"v-model="numNodes"/></div></div></form>',data:data}),vue_info=new Vue({el:document.getElementById("info"),template:'<div class="flex"><div class="flex-fill" v-html="html" v-show="noHaySolrInfo"></div></div>',data:data,computed:{html:function(){return 0<Object.keys(this.info).length?printPanel(null,this.info,!0):"<strong>No hay información que mostrar</strong>"},noHaySolrInfo:function(){return!(this.solrInfo&&0<Object.keys(this.solrInfo).length)}}}),vue_solrInfo=new Vue({el:document.getElementById("solrInfo"),template:'<div class="flex" v-show="haySolrInfo"><div class="flex-fill"><div class="clearfix" style="margin-bottom:1em"><a :href="url" target="_blank" :title="url" v-show="url"><i class="fa-2x" :class="url | extIcon"></i> ver {{url | extType}}</a><div class="pull-right" style="margin:.5em 3.5em .5em 1em"><small>{{"actualDate" | translate}}:</small> <i class="fa fa-calendar"></i> {{actualDate | date}}</div></div><div class="clearfix" style="margin-bottom:1em"><button class="btn btn-default btn-xs"data-trigger="focus"data-placement="bottom"data-toggle="popover"data-container="body"data-html="true":data-content="personas | list":disabled="noHay(personas)"><i class="fa fa-users"></i> {{personas | length}} {{"personas" | translate}}</button>&nbsp;<button class="btn btn-default btn-xs"data-trigger="focus"data-placement="bottom"data-toggle="popover"data-container="body"data-html="true":data-content="organizaciones | list":disabled="noHay(organizaciones)"><i class="fa fa-university"></i> {{organizaciones | length}} {{"organizaciones" | translate}}</button>&nbsp;<button class="btn btn-default btn-xs"data-trigger="focus"data-placement="bottom"data-toggle="popover"data-container="body"data-html="true":data-content="localizaciones | list":disabled="noHay(localizaciones)"><i class="fa fa-location-arrow"></i> {{localizaciones | length}} {{"localizaciones" | translate}}</button>&nbsp;<button class="btn btn-default btn-xs"data-trigger="focus"data-placement="bottom"data-toggle="popover"data-container="body"data-html="true":data-content="categorias | list":disabled="noHay(categorias)"><i class="fa fa-location-arrow"></i> {{categorias | length}} {{"categorias" | translate}}</button></div><div><p v-html="texto"></p></div></div></div>',data:data,computed:{html:function(){return printPanel(null,this.solrInfo,!0)},url:function(){return this.info["Ruta o dirección que sirve para ubicar de manera precisa una web, subdominio o portal"]||""},actualDate:function(){return this.solrInfo.actualDate},personas:function(){return this.solrInfo.personas},organizaciones:function(){return this.solrInfo.organizaciones},localizaciones:function(){return this.solrInfo.localizaciones},categorias:function(){return this.solrInfo.categorias},texto:function(){return this.info["Resumende la web, subdominio o portal del Gobierno de Aragón analizada y procesada"]||this.solrInfo.texto},haySolrInfo:function(){return this.solrInfo&&0<Object.keys(this.solrInfo).length}},methods:{initPopover:function(){var n=this.$el.querySelectorAll('[data-toggle="popover"]');$(n).popover()},noHay:function(n){return!Array.isArray(n)||0===n.length}},filters:{date:function(n){return n?new Date(n).toLocaleString(data.lang).split(" ")[0]:""},translate:function(n){return n in data.translate?data.translate[n][data.lang]:n},extType:function(n){var e=n.toLowerCase();return e.includes(".pdf")?"PDF":e.includes(".doc")?"Ms WORD":"URL"},extIcon:function(n){var e=n.toLowerCase();return"fa fa-"+(e.includes(".pdf")?"file-pdf-o":e.includes(".doc")?"doc":"external-link")},list:function(n){return Array.isArray(n)?"<ol><li>"+n.join("</li><li>")+"</li><ol>":""},length:function(n){return Array.isArray(n)?n.length:0}},mounted:function(){this.initPopover()},updated:function(){this.initPopover()}}),vue_alertMaxNodes=new Vue({el:document.getElementById("alertMaximumNodes"),template:'<div v-html="mssg"></div>',data:data,computed:{mssg:function(){return this.alertMaxNodes?"<div class='alert alert-danger'><strong>Atención:</strong> Mostrando el máximo número de nodos</div>":""}}}),vue_question=new Vue({el:document.getElementById("question"),template:'<input type="text" class="question form-control" placeholder="Pregunte..."v-model="question"@keyup.enter="quepyRequest">',data:data,computed:{url:function(){return this.urlQuestionWorkflow+encodeURIComponent(this.question)}},methods:{quepyRequest:function(){var t=this;$.getJSON(this.url,function(n){var e=n.results.content;t.content=e})}}}),vue_answer=new Vue({el:document.getElementById("answer"),data:data,template:'<div class="answer flex-fill transparent-to-events" v-html="html" @click.prevent="makeQuestion($event)"></div>',computed:{html:function(){return this.answer?this.preguntaValida():this.preguntaNoValida()},answer:function(){return this.content.answer},message:function(){return this.content.message},results:function(){return this.content.results}},methods:{makeQuestion:function(n){n.target.matches(".question-sample")&&(this.question=n.target.textContent,vue_question.$el.focus(),vue_question.quepyRequest())},preguntaNoValida:function(){var n=this.results||[];return Array.isArray(n)?'<div class="list-group"><div class="list-group-item"><p><strong>'+this.message+"</strong></p><ul>"+n.map(function(n){return' <li class="ellipsis"><a class="question-sample">'+n+"</a> </li>"}).join("")+"</ul></div></div>":""},preguntaValida:function(){var e=this;return'<div class="list-group">'+Object.keys(this.results).map(function(n){return'<div class="list-group-item"><p>'+e.message.replace("{0}","<strong>"+n+"</strong>")+"</p><ul>"+Object.entries(e.results[n]).map(function(n){var e=_slicedToArray(n,2),t=(e[0],_slicedToArray(e[1],2)),a=t[0];return' <li class="ellipsis"><a onclick="changeGraph(\''+t[1]+'\',0,0); return false;" title="'+a+'"> '+a+"</a> </li>"}).join("")+"</ul></div>"}).join("")+"</div>"}}}),s=new sigma({settings:{autoRescale:!0,sideMargin:50,rescaleIgnoreSize:!0,minArrowSize:6,animationsTime:1e3,font:"monospace",defaultEdgeColor:"#5ea2ba",edgeColor:"default",defaultNodeColor:"#ffffff",defaultEdgeType:"arrow",borderSize:8,defaultNodeBorderColor:"rgba(255,200,0,0.8)",nodeHoverColor:"default",minNodeSize:0,maxNodeSize:0},renderer:{container:document.getElementById("graph-container"),type:"canvas"}});CustomShapes.init(s),s.refresh(),s.bind("clickNode",function(n){var e=n.data.node;changeGraph(e.nodeName,e["read_cam0:x"],e["read_cam0:y"])}).bind("overNode",function(n){var e=n.data.node;e.label=e.over_label,s.refresh()}).bind("outNode",function(n){var e=n.data.node;e.label=e.ini_label,s.refresh()});var changeGraph=function(n,a,o){var e=URLdomain+"/web-server/rest/executeWorkFlowGet/5afe7a599194be0001f5b21c?save=false&wait=true&concept=",t=$.getJSON(e+encodeURIComponent(n)+"&nodes="+encodeURIComponent(data.numNodes)),r=function(){return t.then(function(n){return n.results.content}).then(i)},i=function(n){var e=document.querySelector(".width0");e&&e.classList.remove("width0");var t={};n.graph.nodes.forEach(function(n){var e=n.label;Object.assign(n,t,{over_label:e,ini_label:e,label:33<e.length?e.slice(0,30)+"...":e,size:20,borderColor:"#5ea2ba",type:"circle",x:a,y:o})}),data.info=n.info||{},data.solrInfo=n.solrInfo||{},data.alertMaxNodes=n.alertMaximumNodes,s.graph.clear(),s.graph.read(n.graph),s.refresh(),sigma.plugins.animate(s,{x:"fin_x",y:"fin_y"},{easing:"cubicInOut",duration:1e3,onComplete:function(){}})};Object.assign(data,{info:{},warning:"<strong>Cargando datos...</strong>",solrInfo:{},alertMaxNodes:!1}),s.graph.nodes().forEach(function(n){n.collapse_x=a,n.collapse_y=o}),sigma.plugins.animate(s,{x:"collapse_x",y:"collapse_y"},{easing:"cubicInOut",duration:250,onComplete:r})};changeGraph("http://opendata.aragon.es/def/ei2a#Entidad420",0,0);